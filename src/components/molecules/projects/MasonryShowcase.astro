---
import type { ImageMetadata } from "astro";

export interface Props {
  images: { src: ImageMetadata; alt?: string }[];
  bgColorImg?: string;
  columns?: number; 
}

const { images, bgColorImg = "#ABC8FF", columns = 3 } = Astro.props;

import { Image } from 'astro:assets';

---

<section class="masonry-section" style={`--bg:${bgColorImg}; --columns:${columns}`}>
  <div class="grid" id="masonry-grid">
    <div class="grid-sizer"></div>
    {images.map((img) => (
      <div class="grid-item">
        <Image class="grid-item__image" src={img.src} alt={img.alt || ""} loading="lazy" />
      </div>
    ))}
  </div>
</section>

<!-- üöÄ Carga Masonry solo en cliente -->
<script>
  import Masonry from 'masonry-layout';
  import imagesLoaded from 'imagesloaded';

  const grid = document.querySelector('#masonry-grid');
  if (grid) {
    imagesLoaded(grid, function () {
      new Masonry(grid, {
        itemSelector: '.grid-item',
        columnWidth: '.grid-sizer',
        percentPosition: true,
        gutter: 14,
        // columnWidth: 200,
      });
    });
  }
</script>

<style lang="scss" scoped>
.masonry-section {
  margin-top: 3rem;
  margin-bottom: 6rem;
  border-radius: 1rem;
  margin-inline: 2rem;
  margin-inline: 0;
  padding-inline: 0;
}

.grid {
  margin: 0 auto;
  width: 100%;
}

/* Define el ancho de las columnas */
.grid-sizer,
.grid-item {
  width: calc(100% / var(--columns) - 0.933rem); // resta el gutter
}

.grid-item {
  margin-bottom: 2rem;
  background-color: var(--bg);
  padding: 1rem; // reducimos padding interno
  border-radius: 1rem;
  overflow: hidden;
  // box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;

  &__image {
    width: 100%;
    height: auto;
    display: block;
  }

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  }
}

/* Responsive */
@media (max-width: 900px) {
  .grid-sizer,
  .grid-item {
    width: 48%;
  }
}
@media (max-width: 600px) {
 
  .grid-item {
    margin-bottom: 1rem;
  }

  .masonry-section {
    --columns: 2; /* incluso en m√≥vil, 2 columnas en vez de 1 */
  }

}
</style>
